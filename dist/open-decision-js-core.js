!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OpenDecisionJSCore",[],t):"object"==typeof exports?exports.OpenDecisionJSCore=t():r.OpenDecisionJSCore=t()}(this,(function(){return(()=>{"use strict";var r={590:(r,t,e)=>{var n,i;function o(r){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}void 0===(i="function"==typeof(n=function(){Array.isArray||(Array.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)});var r={},t={"==":function(r,t){return r==t},"===":function(r,t){return r===t},"!=":function(r,t){return r!=t},"!==":function(r,t){return r!==t},">":function(r,t){return r>t},">=":function(r,t){return r>=t},"<":function(r,t,e){return void 0===e?r<t:r<t&&t<e},"<=":function(r,t,e){return void 0===e?r<=t:r<=t&&t<=e},"!!":function(t){return r.truthy(t)},"!":function(t){return!r.truthy(t)},"%":function(r,t){return r%t},log:function(r){return console.log(r),r},in:function(r,t){return!(!t||void 0===t.indexOf)&&-1!==t.indexOf(r)},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(r,t,e){if(e<0){var n=String(r).substr(t);return n.substr(0,n.length+e)}return String(r).substr(t,e)},"+":function(){return Array.prototype.reduce.call(arguments,(function(r,t){return parseFloat(r,10)+parseFloat(t,10)}),0)},"*":function(){return Array.prototype.reduce.call(arguments,(function(r,t){return parseFloat(r,10)*parseFloat(t,10)}))},"-":function(r,t){return void 0===t?-r:r-t},"/":function(r,t){return r/t},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,(function(r,t){return r.concat(t)}),[])},var:function(r,t){var e=void 0===t?null:t,n=this;if(void 0===r||""===r||null===r)return n;for(var i=String(r).split("."),o=0;o<i.length;o++){if(null==n)return e;if(void 0===(n=n[i[o]]))return e}return n},missing:function(){for(var t=[],e=Array.isArray(arguments[0])?arguments[0]:arguments,n=0;n<e.length;n++){var i=e[n],o=r.apply({var:i},this);null!==o&&""!==o||t.push(i)}return t},missing_some:function(t,e){var n=r.apply({missing:e},this);return e.length-n.length>=t?[]:n}};return r.is_logic=function(r){return"object"===o(r)&&null!==r&&!Array.isArray(r)&&1===Object.keys(r).length},r.truthy=function(r){return!(Array.isArray(r)&&0===r.length||!r)},r.get_operator=function(r){return Object.keys(r)[0]},r.get_values=function(t){return t[r.get_operator(t)]},r.apply=function(e,n){if(Array.isArray(e))return e.map((function(t){return r.apply(t,n)}));if(!r.is_logic(e))return e;var i,o,u,a,s,f=r.get_operator(e),c=e[f];if(Array.isArray(c)||(c=[c]),"if"===f||"?:"==f){for(i=0;i<c.length-1;i+=2)if(r.truthy(r.apply(c[i],n)))return r.apply(c[i+1],n);return c.length===i+1?r.apply(c[i],n):null}if("and"===f){for(i=0;i<c.length;i+=1)if(o=r.apply(c[i],n),!r.truthy(o))return o;return o}if("or"===f){for(i=0;i<c.length;i+=1)if(o=r.apply(c[i],n),r.truthy(o))return o;return o}if("filter"===f)return a=r.apply(c[0],n),u=c[1],Array.isArray(a)?a.filter((function(t){return r.truthy(r.apply(u,t))})):[];if("map"===f)return a=r.apply(c[0],n),u=c[1],Array.isArray(a)?a.map((function(t){return r.apply(u,t)})):[];if("reduce"===f)return a=r.apply(c[0],n),u=c[1],s=void 0!==c[2]?c[2]:null,Array.isArray(a)?a.reduce((function(t,e){return r.apply(u,{current:e,accumulator:t})}),s):s;if("all"===f){if(a=r.apply(c[0],n),u=c[1],!a.length)return!1;for(i=0;i<a.length;i+=1)if(!r.truthy(r.apply(u,a[i])))return!1;return!0}if("none"===f)return 0===r.apply({filter:c},n).length;if("some"===f)return r.apply({filter:c},n).length>0;if(c=c.map((function(t){return r.apply(t,n)})),t.hasOwnProperty(f)&&"function"==typeof t[f])return t[f].apply(n,c);if(f.indexOf(".")>0){var l=String(f).split("."),p=t;for(i=0;i<l.length;i++){if(!p.hasOwnProperty(l[i]))throw new Error("Unrecognized operation "+f+" (failed at "+l.slice(0,i+1).join(".")+")");p=p[l[i]]}return p.apply(n,c)}throw new Error("Unrecognized operation "+f)},r.uses_data=function(t){var e=[];if(r.is_logic(t)){var n=r.get_operator(t),i=t[n];Array.isArray(i)||(i=[i]),"var"===n?e.push(i[0]):i.map((function(t){e.push.apply(e,r.uses_data(t))}))}return function(r){for(var t=[],e=0,n=r.length;e<n;e++)-1===t.indexOf(r[e])&&t.push(r[e]);return t}(e)},r.add_operation=function(r,e){t[r]=e},r.rm_operation=function(r){delete t[r]},r.rule_like=function(t,e){if(e===t)return!0;if("@"===e)return!0;if("number"===e)return"number"==typeof t;if("string"===e)return"string"==typeof t;if("array"===e)return Array.isArray(t)&&!r.is_logic(t);if(r.is_logic(e)){if(r.is_logic(t)){var n=r.get_operator(e),i=r.get_operator(t);if("@"===n||n===i)return r.rule_like(r.get_values(t,!1),r.get_values(e,!1))}return!1}if(Array.isArray(e)){if(Array.isArray(t)){if(e.length!==t.length)return!1;for(var o=0;o<e.length;o+=1)if(!r.rule_like(t[o],e[o]))return!1;return!0}return!1}return!1},r})?n.call(t,e,t,r):n)||(r.exports=i)}},t={};function e(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return r[n](o,o.exports,e),o.exports}var n={};return(()=>{var r=n;r.default=void 0;var t,i=(t=e(590))&&t.__esModule?t:{default:t};function o(r){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function u(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.push.apply(e,n)}return e}function a(r){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?u(Object(e),!0).forEach((function(t){s(r,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):u(Object(e)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))}))}return r}function s(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function f(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}var c=function(){function r(t){(function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.tree=t,this.currentNode=this.tree.header.start_node,this.history={nodes:[],answers:{}},this.state="initialized",this.supportsFileApi=!1,this.COMPATIBLE_VERSIONS=[.1]}var t,e;return t=r,(e=[{key:"startInterpretation",value:function(){return this.state="started",this.getCurrentNode()}},{key:"getCurrentNode",value:function(){return{question:this.replaceVars(this.tree[this.currentNode].text,this.history.answers),inputs:this.tree[this.currentNode].inputs}}},{key:"interpret",value:function(r){return this.state="interpreting",this.history.nodes.push(this.currentNode),this.history.answers[this.currentNode]=r,this.currentNode=function(r,t){if("default"in r.destination)return r.destination.default;if(0===Object.keys(r.rules).length)return r.destination[t];var e=i.default.apply(r.rules,t);return r.destination[e]}(this.tree[this.currentNode],r),this.state="idle",this.getCurrentNode()}},{key:"treeName",get:function(){return this.tree.header.tree_name}},{key:"goBack",value:function(){return this.history.nodes.length>0?(delete this.history.answers[this.currentNode],this.currentNode=this.history.nodes.pop()):(this.currentNode=this.tree.header.start_node,this.history={nodes:[],answers:{}}),this.getCurrentNode()}},{key:"reset",value:function(){return this.currentNode=this.tree.header.start_node,this.history={nodes:[],answers:{}},this.getCurrentNode()}},{key:"getInterpretationState",value:function(){var r={header:a({},this.tree.header),log:a({},this.history),currentNode:this.currentNode};return JSON.stringify(r)}},{key:"setInterpretationState",value:function(r){var t=JSON.parse(r);t.header.tree_slug===this.tree.header.tree_slug?(this.currentNode=t.currentNode,this.history=t.log,this.getCurrentNode()):alert("Please load the correct save data.")}},{key:"checkCompatibility",value:function(){for(var r=!1,t=0;t<COMPATIBLE_VERSIONS.length;t++)COMPATIBLE_VERSIONS[t]===this.tree.header.version&&(r=!0);if(!r)throw{name:"IncompatibleVersion",message:"The provided file uses the Open Decision dataformat version ".concat(this.tree.header.version,". This library only supports ").concat(COMPATIBLE_VERSIONS,"."),toString:function(){return this.name+": "+this.message}}}},{key:"replaceVars",value:function(r,t){for(var e=/\[\[([^\]]+)]]/g,n=e.exec(r);null!=n;){var i=void 0;n[1]=n[1].trim();var u=n[1].indexOf(".");if(-1!==u){var a=n[1].substring(0,u),s=n[1].substring(u+1);i=a in t?t[a][s]:"MISSING"}else i=n[1]in t?t[n[1]]:"MISSING";if("number"==typeof i)try{var f=tree[n[1]].inputs[0].options[i];void 0!==f&&(i=f)}catch(r){}else if("object"===o(i))try{i=t[n[1]].a}catch(r){}r=r.replace(n[0],i),n=e.exec(r)}return r}}])&&f(t.prototype,e),r}();r.default=c})(),n.default})()}));